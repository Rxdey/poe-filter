import{_ as H,t as W,g as ae,r as te,c as oe,a as se}from"./Load-cc4c7cf8.js";import{S as ne,_ as de,f as ue,a as ce,c as q}from"./FilterTree-91e5a79d.js";import{u as j,C as G,a as re}from"./Card-77f1c9e6.js";import{r as c,b as ie,w as z,e as b,x as pe,o as g,j as $,h as r,a as t,t as Y,f as u,k as v,u as I,y as _e,z as ve,c as E,s as fe,F as N,i as K,g as T,E as x,_ as Q,n as me,A as ge,p as X,l as Z}from"./index-1d1db870.js";const ye={class:"search"},Ce={class:"car-all-list",id:"car-all-list"},he={class:"dialog-footer"},Se={class:"statistics"},be={__name:"CardAll",props:{modelValue:{type:Boolean,default:!1},defaultSelected:{type:Array,default:()=>[]},data:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(y,{emit:k}){const C=y,i=j(),m=c(C.modelValue),h=c(1),S=c(50),s=c([]),o=c(!1),V=c(!1),p=c([]),B=c(""),O=c([]),P=async()=>{o.value=!0;const e=await i.UPDATE_FILTER_CARD(p.value,C.data);if(o.value=!1,!e){x.error("添加失败");return}m.value=!1,x.success("添加成功")},R=e=>{if(V.value=!0,e=e.trim(),!e){h.value=1,s.value=[],a();return}const l=i.allCardList.filter(d=>{var D;return((D=d.name)==null?void 0:D.search(e))>-1||W(d.id).toUpperCase()===e.toUpperCase()||d.explicitMod.some(J=>{var A;return((A=J.value)==null?void 0:A.search(e))>-1})});s.value=l.map(d=>({...d,selected:p.value.some(D=>D.id===d.id)}))},U=()=>{h.value=1,s.value=[],B.value="",o.value=!0,a()},F=e=>{const l=s.value.find(d=>d.id===e);l&&(l.selected=!l.selected),l.selected?p.value.push(l):p.value=p.value.filter(d=>d.id!==e)},M=({page:e=1,pagesize:l=10})=>JSON.parse(JSON.stringify(O.value)).slice((e-1)*l,l*e),n=async()=>{O.value=i.allCardList.map(e=>({...e,selected:p.value.some(l=>l.id===e.id)})).sort((e,l)=>(e.selected?0:1)-(l.selected?0:1)),a()},a=async()=>{const e=M({page:h.value,pagesize:S.value});o.value=!0,s.value=s.value.concat(e.map(l=>({...l,selected:p.value.some(d=>d.id===l.id)}))),h.value+=1,V.value=e.length<S.value,o.value=!1},_=e=>{if(o.value||V.value)return;document.querySelector("#car-all-list").offsetHeight-500<=e.target.scrollTop+10&&(o.value=!0,a())},f=e=>{if(o.value){x.info("请稍等");return}e()};return ie(()=>{p.value=i.allCardList.filter(e=>C.defaultSelected.some(l=>l.id===e.id)),o.value=!0,setTimeout(()=>{n()},200)}),z(()=>m.value,e=>{k("update:modelValue",e)}),z(()=>C.modelValue,e=>{m.value=e}),(e,l)=>{const d=b("el-input"),D=b("el-col"),J=b("el-row"),A=b("el-button"),ee=b("el-dialog"),le=pe("loading");return g(),$(ee,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=w=>m.value=w),title:"添加卡片",class:"card-all-dialog","before-close":f},{footer:r(()=>[t("span",he,[t("span",Se,"已加载: "+Y(s.value.length)+" / "+Y(O.value.length),1),u(A,{type:"danger",plain:"",round:"",onClick:l[1]||(l[1]=w=>m.value=!1),disabled:o.value},{default:r(()=>[v("取消")]),_:1},8,["disabled"]),u(A,{round:"",plain:"",onClick:P,disabled:o.value},{default:r(()=>[v("我已选定")]),_:1},8,["disabled"])])]),default:r(()=>[t("div",ye,[u(J,null,{default:r(()=>[u(D,{span:24},{default:r(()=>[u(d,{modelValue:B.value,"onUpdate:modelValue":l[0]||(l[0]=w=>B.value=w),placeholder:"输入关键词搜索(卡片名、奖励名)","suffix-icon":I(_e),onInput:R},null,8,["modelValue","suffix-icon"])]),_:1})]),_:1})]),ve((g(),E("div",{class:"card-all",onScroll:_,style:fe({"overflow-y":o.value?"hidden":"auto"})},[t("div",Ce,[(g(!0),E(N,null,K(s.value,(w,je)=>(g(),$(G,{key:w.type,name:w.id,icon:"Check",color:"#67c23a",onOnCardClick:F,selected:w.selected||!1},null,8,["name","selected"]))),128)),s.value.length?T("",!0):(g(),$(H,{key:0,onClick:U},{default:r(()=>[v("没有了, 点我重新加载吧")]),_:1}))])],36)),[[le,o.value]])]),_:1},8,["modelValue"])}}};const ke=y=>(X("data-v-e9b361a1"),y=y(),Z(),y),Ve={class:"card-setting"},we={key:0,class:"card-list"},xe=ke(()=>t("div",{class:"add-card-mask"},null,-1)),$e={__name:"CardSetting",props:{data:{type:Object,default:()=>({})}},setup(y){const k=y,C=j(),i=c(!1),m=me(()=>C.getFilterCardByLabel(k.data.label)),h=S=>{console.log(S),ge.confirm(`确定要从此分类移除该卡片${W(S)}吗？`,"移除卡片",{confirmButtonText:"确定移除",cancelButtonText:"取消","confirm-button-class":"confirmButton"}).then(()=>{C.REMOVE_CARD_BY_ID(S),x({type:"success",message:"已移除"})}).catch(()=>{})};return(S,s)=>{const o=b("Plus"),V=b("el-icon");return g(),E(N,null,[t("div",Ve,[u(ne,{config:k.data,label:k.data.label},null,8,["config","label"]),I(m)?(g(),E("div",we,[t("div",{class:"add-card",onClick:s[0]||(s[0]=p=>i.value=!0)},[u(V,null,{default:r(()=>[u(o)]),_:1}),xe]),(g(!0),E(N,null,K(I(m),(p,B)=>(g(),$(G,{key:p.type,name:p.id,onOnCardClick:h},null,8,["name"]))),128))])):T("",!0)]),i.value?(g(),$(be,{key:0,modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=p=>i.value=p),defaultSelected:I(m),data:k.data},null,8,["modelValue","defaultSelected","data"])):T("",!0)],64)}}},Be=Q($e,[["__scopeId","data-v-e9b361a1"]]);const L=y=>(X("data-v-1e0d105b"),y=y(),Z(),y),De={class:"home destiny"},Ee={class:"tool-bar"},Le={class:"card-wrap"},Oe={class:"card-aside"},Ae={class:"card-main"},Te={class:"tip"},Ie={class:"tip"},Ne=L(()=>t("p",null,"每个赛季命运卡池会有些许变化，本项目完全离线，所有需要自行添加更新",-1)),Pe=L(()=>t("p",null,[v("点击此链接前往编年史 "),t("a",{href:"https://poedb.tw/cn/Divination_Cards#命运卡物品",target:"_blank"},"流亡编年史#命运卡物品 ")],-1)),Re=L(()=>t("p",null,[v("页面加载完毕后，按"),t("span",{class:"code"},"F12"),v("或者右键页面选择"),t("span",{class:"code"},"检查")],-1)),Ue=L(()=>t("p",null,[v("弹出页面选择"),t("span",{class:"code"},"控制台"),v("(英文界面选择"),t("span",{class:"code"},"console"),v(")")],-1)),Fe=L(()=>t("p",null,"点击下面复制按钮，复制代码在上面编年史页面控制台粘贴并回车",-1)),Me=L(()=>t("p",null,"然后粘贴到下面的文本框保存...",-1)),Je={__name:"destiny",setup(y){const k=j(),C=c(null),i=c(null),m=c([]),h=c(null),S=c(!1),s=c(!1),o=c(""),V=c(""),p=()=>{try{const n=JSON.parse(V.value);oe.setItem("CARD_POOL",n),x.success("已保存，页面将会自动刷新"),s.value=!1,setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.log(n),x.error("数据不正确")}},B=()=>{se(re,()=>{x.success("已复制，请根据提示操作")})},O=n=>{"status"in n&&(console.log(n),h.value=n)},P=async n=>{console.log(n);const a=[];n.forEach(_=>{_.children.forEach(f=>{var l;if(!f.BaseType)return;const e=(l=f.BaseType)==null?void 0:l.split(",").map(d=>({id:d.toLowerCase().replace(/\s/g,"-").replace(/'/g,""),type:d,label:f.label}));a.push(...e)})}),k.SAVE_FILTER_CARD(a)},R=async n=>{const a=n.target.files[0];if(ae(a.name)!=="filter"){x.error("请选择.filter格式文件"),document.querySelector("#file").value="";return}const _=await te(a),f=ue(_).filter(e=>/命运卡/.test(e.label));console.log(f),h.value=null,o.value="",i.value=f,m.value=ce(f).filter(e=>e.status).map(e=>e.id),P(f)},U=()=>{document.querySelector("#file").value="",C.value&&C.value.click()},F=(n=[],a="")=>n.filter(_=>_.label===a),M=()=>{const n=JSON.parse(JSON.stringify(k.filterCard)),a=[];i.value[0].children.map((_,f)=>{const e=F(n,_.label).map(l=>l.type);a.push({..._,BaseType:e.reduce((l,d)=>(l+=`"${d}",`,l),""),className:i.value[0].label})}),console.log(a),console.log(q(a)),S.value=!0,o.value=q(a)};return(n,a)=>{const _=b("el-button"),f=b("el-input"),e=b("el-dialog");return g(),E(N,null,[t("div",De,[t("div",Ee,[u(_,{round:"",plain:"",onClick:U},{default:r(()=>[v("导入过滤")]),_:1}),u(_,{round:"",type:"danger",plain:"",disabled:!i.value,onClick:M},{default:r(()=>[v("保存")]),_:1},8,["disabled"]),u(_,{round:"",plain:"",onClick:a[0]||(a[0]=l=>s.value=!0)},{default:r(()=>[v("更新卡池")]),_:1})]),t("div",Le,[t("div",Oe,[u(de,{data:i.value,"default-checked-keys":m.value,onNodeClick:O,"default-expand-all":""},null,8,["data","default-checked-keys"]),i.value?T("",!0):(g(),$(H,{key:0},{default:r(()=>[v("请先导入")]),_:1}))]),t("div",Ae,[h.value?(g(),$(Be,{key:0,data:h.value},null,8,["data"])):T("",!0)])]),t("input",{type:"file",id:"file",onChange:R,hidden:"",ref_key:"inputRef",ref:C},null,544)]),u(e,{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=l=>S.value=l),title:"不想写了，请自行复制替换",class:"update-card-dialog"},{default:r(()=>[t("div",Te,[u(f,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value=l),rows:20,type:"textarea",readonly:""},null,8,["modelValue"])])]),_:1},8,["modelValue"]),u(e,{modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=l=>s.value=l),title:"更新命运卡池",class:"update-card-dialog"},{footer:r(()=>[u(_,{round:"",type:"danger",plain:"",onClick:p},{default:r(()=>[v("保存")]),_:1})]),default:r(()=>[t("div",Ie,[Ne,Pe,Re,Ue,Fe,t("p",null,[u(_,{round:"",plain:"",onClick:B},{default:r(()=>[v("复制")]),_:1})]),Me,u(f,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=l=>V.value=l),rows:5,type:"textarea",placeholder:"在此处粘贴结果"},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}},We=Q(Je,[["__scopeId","data-v-1e0d105b"]]);export{We as default};
